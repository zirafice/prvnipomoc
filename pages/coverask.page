<?php
//var_dump($_POST);exit;
if(isset($_POST["title"])){
    $dblink=mysql_connect($db["host"],$db["user"],$db["pw"])
	or die("Chyba ppřipojení k databázi");
    mysql_select_db($db["dbname"],$dblink);
    mysql_set_charset('utf8',$dblink);
    
    $time=time();
    $title = mysql_escape_string($_POST["title"]);
    $author = mysql_escape_string($_POST["autor"]);
    $wp_user = mysql_escape_string($_POST["wpuser"]);
    $zanr = mysql_escape_string($_POST["zanr"]);
    $popis = mysql_escape_string($_POST["popis"]);
    
    $querystr  = "ID = ".$time;
    $querystr .= ", title='".$title."'";
    $querystr .= ", author='".$author."'";
    $querystr .= ", popis='".$popis."'";
    $querystr .= ", wp_user='".$wp_user."'";
    $querystr .= ", zanr='".$zanr."'";
    if(strlen($_POST["pocit"]) > 0){
	$querystr .= ",pocit='".mysql_escape_string($_POST["pocit"])."'";
    }
    else{
	$querystr .= ",pocit=NULL";
    }

    if(strlen($_POST["info"]) > 0){
	$querystr .= ", info='".mysql_escape_string($_POST["info"])."'";
    }
    else{
	$querystr .= ", info=NULL";
    }
    if(strlen($_POST["email"]) > 0){
	$querystr .= ", email='".mysql_escape_string($_POST["pocit"])."'";
    }
    else{
	$querystr .= ", email=NULL";
    }
    
    $query="INSERT INTO `cover_request` SET " . $querystr;
    
    mysql_query($query,$dblink)
	or die("Chyba vlozeni - dotaz: ".$query);
    mysql_close($dblink);
    
    $subject = "New cover request";
    $message = "<html><table style=\"text-align:left;\">";
    $message .= "<tr><th style=\"text-align:left;\">Input date:</th><td style=\"text-align:left;\">".date("d.m. Y",$time)."</td></tr>";
    $message .= "<tr><th style=\"text-align:left;\">Title:</th><td style=\"text-align:left;\">".$title."</td></tr>";
    $message .= "<tr><th style=\"text-align:left;\">Author:</th><td style=\"text-align:left;\">".$author." <i>(@".$wp_user.")</i></td></tr>";
    $message .= "</table></html>";
    
    $headerFields = array(
        "MIME-Version: 1.0",
        "Content-Type: text/html;charset=utf-8",
	"From: prvni.pomoc@post.cz"
    );
    mail("prvni.pomoc@post.cz",$subject,$message,implode("\n", $headerFields));
    header("Location: index.php?page=thanks");
}
?>
<script src="./js/form_verify.js"></script>
<center><h1>Žádost o cover </h1></center>
<form name="coverrequest" method="POST" action="index.php"> 
 <table><tr>
   <td><span class="havetobe">Jméno díla</span></td><td><input type="text" name="title" size=64></td></td>
 </tr><tr>
   <td><span  class="havetobe">Autor</span><br><span class="note">(tak jak má vypadat na obálce)</span></td><td><input type="text" name="autor" size=64></td>
 </tr><tr>
   <td><span class="havetobe">Žánr</span></td><td><input type="text" name="zanr" size=32></td>
 </tr><tr>
   <td>Pocit, jakým by měl cover působit</td><td><input type="text" name="pocit" size=32></td>
 </tr><tr>
   <td><span class="havetobe">Stručný popis díla</span></td><td><textarea name="popis" cols=50 rows=10></textarea></td>
 </tr><tr>
   <td>Další info <br><span class="note">(postavy, vaše představy či požadavky, ...)</span></td><td><textarea name="info" cols=50 rows=10></textarea></td>
 </tr><tr>
   <td><span class="havetobe">Wattpad uživatel</span></td><td><input type="text" name="wpuser" size=32></td>
 </tr><tr>
   <td>E-mail</i></td><td><input type="text" name="email" size=64></td>
 </tr><tr>
   <td colspan=2 style="text-align: right"><input type="button" name="check_and_save" value="Odeslat" style="border: 1px solid black" onClick="VerifyCoverForm(document.coverrequest)"></td>
 </tr></table>
</form>
